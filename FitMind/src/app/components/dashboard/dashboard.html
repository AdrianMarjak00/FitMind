<div class="modern-dashboard">
  <!-- ğŸ”¥ HERO SEKCIA - DennÃ© ciele -->
  <section class="hero-section">
    <div class="container">
      @if (userProfile) {
        <div class="hero-content">
          <div class="greeting">
            <h1>Vitaj spÃ¤Å¥, {{ userProfile.firstName }}! ğŸ‘‹</h1>
            <p>{{ getCurrentDateMessage() }}</p>
          </div>
          
          <!-- DennÃ© ciele karty -->
          <div class="daily-goals">
            <!-- KalÃ³rie -->
            <div class="goal-card calories-card">
              <div class="card-header">
                <span class="icon">ğŸ½ï¸</span>
                <h3>KalÃ³rie</h3>
              </div>
              <div class="progress-info">
                <div class="numbers">
                  <span class="current">{{ todayStats.calories.consumed }}</span>
                  <span class="separator">/</span>
                  <span class="target">{{ todayStats.calories.target }} kcal</span>
                </div>
                <div class="remaining">
                  ZostÃ¡va: <strong>{{ todayStats.calories.remaining }} kcal</strong>
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width.%]="getPercentage(todayStats.calories.consumed, todayStats.calories.target)"></div>
              </div>
              <span class="percentage">{{ getPercentage(todayStats.calories.consumed, todayStats.calories.target) | number:'1.0-0' }}%</span>
            </div>

            <!-- CviÄenie -->
            <div class="goal-card exercise-card">
              <div class="card-header">
                <span class="icon">ğŸ’ª</span>
                <h3>CviÄenie</h3>
              </div>
              <div class="progress-info">
                <div class="numbers">
                  <span class="current">{{ todayStats.exercise.minutes }}</span>
                  <span class="separator">/</span>
                  <span class="target">{{ todayStats.exercise.target }} min</span>
                </div>
                <div class="remaining">
                  @if (todayStats.exercise.minutes >= todayStats.exercise.target) {
                    <strong class="success">âœ… CieÄ¾ splnenÃ½!</strong>
                  } @else {
                    ZostÃ¡va: <strong>{{ todayStats.exercise.target - todayStats.exercise.minutes }} min</strong>
                  }
                </div>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width.%]="getPercentage(todayStats.exercise.minutes, todayStats.exercise.target)"></div>
              </div>
              <span class="percentage">{{ getPercentage(todayStats.exercise.minutes, todayStats.exercise.target) | number:'1.0-0' }}%</span>
            </div>

            <!-- VÃ¡ha -->
            <div class="goal-card weight-card">
              <div class="card-header">
                <span class="icon">âš–ï¸</span>
                <h3>VÃ¡ha</h3>
              </div>
              <div class="progress-info">
                <div class="numbers">
                  <span class="current">{{ userProfile.currentWeight || 0 }}</span>
                  <span class="separator">â†’</span>
                  <span class="target">{{ userProfile.targetWeight || 0 }} kg</span>
                </div>
                <div class="remaining">
                  Rozdiel: <strong>{{ (userProfile.currentWeight || 0) - (userProfile.targetWeight || 0) | number:'1.1-1' }} kg</strong>
                </div>
              </div>
              <div class="weight-progress">
                <div class="bmi">
                  <span>BMI:</span>
                  <strong>{{ calculateBMI() }}</strong>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </section>

  <!-- ğŸ“Š DASHBOARD OBSAH -->
  <div class="dashboard-container">
    <!-- Ä½AVÃ STRANA - RÃ½chle akcie + Stats -->
    <aside class="sidebar">
      <!-- PridaÅ¥ zÃ¡znam -->
      <div class="widget quick-add">
        <h2>âš¡ RÃ½chle pridanie</h2>
        
        <div class="tabs">
          <button 
            *ngFor="let tab of tabs" 
            [class.active]="activeTab === tab.id"
            (click)="activeTab = tab.id">
            {{ tab.icon }} {{ tab.label }}
          </button>
        </div>

        <!-- FormulÃ¡re -->
        <div class="form-container">
          <!-- KalÃ³rie -->
          @if (activeTab === 'calories') {
            <form (ngSubmit)="addCalorieEntry()" class="entry-form">
              <mat-form-field appearance="outline">
                <mat-label>Typ jedla</mat-label>
                <mat-select [(ngModel)]="calorieForm.meal" name="meal" required>
                  <mat-option value="breakfast">ğŸ³ RaÅˆajky</mat-option>
                  <mat-option value="lunch">ğŸ± Obed</mat-option>
                  <mat-option value="dinner">ğŸ½ï¸ VeÄera</mat-option>
                  <mat-option value="snack">ğŸ Desiata</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>ÄŒo si jedol?</mat-label>
                <textarea matInput [(ngModel)]="calorieForm.foods" name="foods" rows="2" required placeholder="napr. Perkelt s ryÅ¾ou"></textarea>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>KalÃ³rie (kcal)</mat-label>
                <input matInput type="number" [(ngModel)]="calorieForm.calories" name="calories" required placeholder="500" />
              </mat-form-field>

              <!-- NutriÄnÃ© hodnoty -->
              <div class="nutrition-grid">
                <mat-form-field appearance="outline">
                  <mat-label>Bielkoviny (g)</mat-label>
                  <input matInput type="number" step="0.1" [(ngModel)]="calorieForm.protein" name="protein" placeholder="30" (ngModelChange)="calculateCaloriesFromMacros()" />
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Sacharidy (g)</mat-label>
                  <input matInput type="number" step="0.1" [(ngModel)]="calorieForm.carbs" name="carbs" placeholder="60" (ngModelChange)="calculateCaloriesFromMacros()" />
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Tuky (g)</mat-label>
                  <input matInput type="number" step="0.1" [(ngModel)]="calorieForm.fats" name="fats" placeholder="15" (ngModelChange)="calculateCaloriesFromMacros()" />
                </mat-form-field>
              </div>
              
              @if (calorieForm.autoCalculate && (calorieForm.protein > 0 || calorieForm.carbs > 0 || calorieForm.fats > 0)) {
                <div class="auto-calc-info">
                  âœ¨ Auto-kalkulÃ¡cia: <strong>{{ calorieForm.calories }} kcal</strong>
                  <small>(P: {{ calorieForm.protein * 4 }} + C: {{ calorieForm.carbs * 4 }} + T: {{ calorieForm.fats * 9 }})</small>
                </div>
              }

              <button mat-flat-button color="primary" type="submit">
                PridaÅ¥ zÃ¡znam
              </button>
            </form>
          }

          <!-- CviÄenie -->
          @if (activeTab === 'exercise') {
            <form (ngSubmit)="addExerciseEntry()" class="entry-form">
              <mat-form-field appearance="outline">
                <mat-label>Typ cviÄenia</mat-label>
                <mat-select [(ngModel)]="exerciseForm.type" name="type" required>
                  <mat-option value="cardio">ğŸƒ Kardio</mat-option>
                  <mat-option value="strength">ğŸ’ª PosilÅˆovanie</mat-option>
                  <mat-option value="flexibility">ğŸ§˜ StreÄing</mat-option>
                  <mat-option value="sports">âš½ Å port</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Trvanie (minÃºty)</mat-label>
                <input matInput type="number" [(ngModel)]="exerciseForm.duration" name="duration" required placeholder="30" />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Intenzita</mat-label>
                <mat-select [(ngModel)]="exerciseForm.intensity" name="intensity" required>
                  <mat-option value="low">NÃ­zka</mat-option>
                  <mat-option value="medium">StrednÃ¡</mat-option>
                  <mat-option value="high">VysokÃ¡</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>SpÃ¡lenÃ© kalÃ³rie (voliteÄ¾nÃ©)</mat-label>
                <input matInput type="number" [(ngModel)]="exerciseForm.caloriesBurned" name="caloriesBurned" placeholder="200" />
              </mat-form-field>

              <button mat-flat-button color="primary" type="submit">
                PridaÅ¥ cviÄenie
              </button>
            </form>
          }

          <!-- VÃ¡ha -->
          @if (activeTab === 'weight') {
            <form (ngSubmit)="addWeightEntry()" class="entry-form">
              <mat-form-field appearance="outline">
                <mat-label>VÃ¡ha (kg)</mat-label>
                <input matInput type="number" step="0.1" [(ngModel)]="weightForm.weight" name="weight" required />
              </mat-form-field>

              <button mat-flat-button color="primary" type="submit">
                ZaznamenaÅ¥ vÃ¡hu
              </button>
            </form>
          }

          <!-- NÃ¡lada -->
          @if (activeTab === 'mood') {
            <form (ngSubmit)="addMoodEntry()" class="entry-form">
              <mat-form-field appearance="outline">
                <mat-label>Ako sa cÃ­tiÅ¡? (1-10)</mat-label>
                <input matInput type="number" min="1" max="10" [(ngModel)]="moodForm.score" name="score" required />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>PoznÃ¡mka (voliteÄ¾nÃ©)</mat-label>
                <textarea matInput [(ngModel)]="moodForm.note" name="note" rows="2"></textarea>
              </mat-form-field>

              <button mat-flat-button color="primary" type="submit">
                ZaznamenaÅ¥ nÃ¡ladu
              </button>
            </form>
          }

          <!-- SpÃ¡nok -->
          @if (activeTab === 'sleep') {
            <form (ngSubmit)="addSleepEntry()" class="entry-form">
              <mat-form-field appearance="outline">
                <mat-label>Hodiny spÃ¡nku</mat-label>
                <input matInput type="number" step="0.5" [(ngModel)]="sleepForm.hours" name="hours" required />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Kvalita spÃ¡nku</mat-label>
                <mat-select [(ngModel)]="sleepForm.quality" name="quality" required>
                  <mat-option value="poor">SlabÃ¡</mat-option>
                  <mat-option value="fair">PriemernÃ¡</mat-option>
                  <mat-option value="good">DobrÃ¡</mat-option>
                  <mat-option value="excellent">VÃ½bornÃ¡</mat-option>
                </mat-select>
              </mat-form-field>

              <button mat-flat-button color="primary" type="submit">
                ZaznamenaÅ¥ spÃ¡nok
              </button>
            </form>
          }

          <!-- Stres -->
          @if (activeTab === 'stress') {
            <form (ngSubmit)="addStressEntry()" class="entry-form">
              <mat-form-field appearance="outline">
                <mat-label>ÃšroveÅˆ stresu (1-10)</mat-label>
                <input matInput type="number" min="1" max="10" [(ngModel)]="stressForm.level" name="level" required />
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>SpÃºÅ¡Å¥aÄe stresu</mat-label>
                <textarea matInput [(ngModel)]="stressForm.source" name="source" rows="2"></textarea>
              </mat-form-field>

              <button mat-flat-button color="primary" type="submit">
                ZaznamenaÅ¥ stres
              </button>
            </form>
          }
        </div>
      </div>

      <!-- TÃ½Å¾dennÃ½ sÃºhrn -->
      <div class="widget weekly-summary">
        <h2>ğŸ“… Tento tÃ½Å¾deÅˆ</h2>
        <div class="summary-stats">
          <div class="stat">
            <span class="icon">ğŸ½ï¸</span>
            <div>
              <p class="label">PriemernÃ© kalÃ³rie</p>
              <p class="value">{{ weeklyStats.calories.avg | number:'1.0-0' }} kcal</p>
            </div>
          </div>
          <div class="stat">
            <span class="icon">ğŸ’ª</span>
            <div>
              <p class="label">CelkovÃ© cviÄenie</p>
              <p class="value">{{ weeklyStats.exercise.total }} min</p>
            </div>
          </div>
          <div class="stat">
            <span class="icon">ğŸ“Š</span>
            <div>
              <p class="label">DnÃ­ zaznamenanÃ©</p>
              <p class="value">{{ weeklyStats.calories.days }} / 7</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- AI NÃ¡vrhy na vyrovnanie prÃ­jmu -->
      <div class="widget ai-suggestions">
        <div class="widget-header" (click)="toggleAISuggestions()">
          <h2>ğŸ¤– AI NÃ¡vrhy</h2>
          <span class="toggle-icon">{{ showAISuggestions ? 'â–¼' : 'â–¶' }}</span>
        </div>
        
        @if (showAISuggestions) {
          <div class="suggestions-content">
            @if (aiSuggestions.length > 0) {
              <div class="suggestion-item" *ngFor="let suggestion of aiSuggestions">
                {{ suggestion }}
              </div>
            } @else {
              <p class="no-suggestions">Pridajte zÃ¡znamy pre AI nÃ¡vrhy</p>
            }
            
            <button class="refresh-btn" (click)="loadAISuggestions()">
              ğŸ”„ ObnoviÅ¥ nÃ¡vrhy
            </button>
          </div>
        }
      </div>
    </aside>

    <!-- PRAVÃ STRANA - Grafy a vizualizÃ¡cie -->
    <main class="main-content">
      <h2>ğŸ“Š Tvoje Å¡tatistiky</h2>

      @if (loading) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>NaÄÃ­tavam dÃ¡ta...</p>
        </div>
      } @else {
        <div class="charts-grid">
          <!-- Graf 1: KalÃ³rie -->
          <div class="chart-card">
            <div class="chart-header">
              <h3>ğŸ½ï¸ KalÃ³rie podÄ¾a jedla</h3>
              <div class="header-actions">
                <span class="badge">7 dnÃ­</span>
                <button class="details-btn" (click)="openDetailsPanel('food')">
                  ğŸ“‹ Detaily ({{ recentFoodEntries.length }})
                </button>
              </div>
            </div>
            <div echarts [options]="caloriesChart" class="chart"></div>
          </div>

          <!-- Graf 2: CviÄenie -->
          <div class="chart-card">
            <div class="chart-header">
              <h3>ğŸ’ª CviÄenie podÄ¾a typu</h3>
              <div class="header-actions">
                <span class="badge">7 dnÃ­</span>
                <button class="details-btn" (click)="openDetailsPanel('exercise')">
                  ğŸ“‹ Detaily ({{ recentExerciseEntries.length }})
                </button>
              </div>
            </div>
            <div echarts [options]="exerciseChart" class="chart"></div>
          </div>

          <!-- Graf 3: VÃ¡ha -->
          <div class="chart-card full-width">
            <div class="chart-header">
              <h3>âš–ï¸ VÃ½voj vÃ¡hy</h3>
              <div class="header-actions">
                <span class="badge">90 dnÃ­</span>
                <button class="details-btn" (click)="openDetailsPanel('weight')">
                  ğŸ“‹ Detaily ({{ recentWeightEntries.length }})
                </button>
              </div>
            </div>
            <div echarts [options]="weightChart" class="chart"></div>
          </div>

          <!-- Graf 4: NÃ¡lada -->
          <div class="chart-card">
            <div class="chart-header">
              <h3>ğŸ˜Š NÃ¡lada</h3>
              <div class="header-actions">
                <span class="badge">30 dnÃ­</span>
                <button class="details-btn" (click)="openDetailsPanel('mood')">
                  ğŸ“‹ Detaily ({{ recentMoodEntries.length }})
                </button>
              </div>
            </div>
            <div echarts [options]="moodChart" class="chart"></div>
          </div>

          <!-- Graf 5: Stres -->
          <div class="chart-card">
            <div class="chart-header">
              <h3>ğŸ˜° ÃšroveÅˆ stresu</h3>
              <div class="header-actions">
                <span class="badge">30 dnÃ­</span>
                <button class="details-btn" (click)="openDetailsPanel('stress')">
                  ğŸ“‹ Detaily ({{ recentStressEntries.length }})
                </button>
              </div>
            </div>
            <div echarts [options]="stressChart" class="chart"></div>
          </div>

          <!-- Graf 6: SpÃ¡nok -->
          <div class="chart-card">
            <div class="chart-header">
              <h3>ğŸ˜´ Kvalita spÃ¡nku</h3>
              <div class="header-actions">
                <span class="badge">7 dnÃ­</span>
                <button class="details-btn" (click)="openDetailsPanel('sleep')">
                  ğŸ“‹ Detaily ({{ recentSleepEntries.length }})
                </button>
              </div>
            </div>
            <div echarts [options]="sleepChart" class="chart"></div>
          </div>
        </div>
      }
    </main>
  </div>
  
  <!-- ğŸ“‹ DETAIL PANEL (slide-in z pravej strany) -->
  @if (showDetailsPanel) {
    <div class="detail-overlay" (click)="closeDetailsPanel()"></div>
    <aside class="detail-panel" [@slideIn]>
      <div class="panel-header">
        <h2>{{ getDetailTitle() }}</h2>
        <button class="close-btn" (click)="closeDetailsPanel()">âœ•</button>
      </div>
      
      <div class="panel-content">
        @if (getSelectedEntries().length > 0) {
          <!-- Food entries -->
          @if (selectedDetailType === 'food') {
            <div class="detail-item" *ngFor="let entry of getSelectedEntries()">
              <div class="detail-header">
                <strong>{{ entry.name }}</strong>
                <div class="header-actions">
                  <span class="badge-small">{{ entry.mealType }}</span>
                  <button class="delete-btn" (click)="deleteEntry(entry.id, 'food')">ğŸ—‘ï¸</button>
                </div>
              </div>
              
              <!-- HlavnÃ© info - KalÃ³rie -->
              <div class="calories-big">
                <span class="label">CelkovÃ© kalÃ³rie</span>
                <span class="value-big">{{ entry.calories }} kcal</span>
              </div>
              
              <!-- NutriÄnÃ© hodnoty v grid -->
              @if (entry.protein || entry.carbs || entry.fats) {
                <div class="nutrition-breakdown">
                  <div class="macro-item">
                    <span class="macro-icon">ğŸ¥©</span>
                    <div>
                      <span class="macro-label">Bielkoviny</span>
                      <span class="macro-value">{{ entry.protein || 0 }}g</span>
                    </div>
                  </div>
                  <div class="macro-item">
                    <span class="macro-icon">ğŸ</span>
                    <div>
                      <span class="macro-label">Sacharidy</span>
                      <span class="macro-value">{{ entry.carbs || 0 }}g</span>
                    </div>
                  </div>
                  <div class="macro-item">
                    <span class="macro-icon">ğŸ§ˆ</span>
                    <div>
                      <span class="macro-label">Tuky</span>
                      <span class="macro-value">{{ entry.fats || 0 }}g</span>
                    </div>
                  </div>
                </div>
              }
              
              <div class="detail-info">
                <span class="timestamp">{{ formatDate(entry.timestamp) }}</span>
              </div>
            </div>
          }
          
          <!-- Exercise entries -->
          @if (selectedDetailType === 'exercise') {
            <div class="detail-item" *ngFor="let entry of getSelectedEntries()">
              <div class="detail-header">
                <strong>{{ entry.type }}</strong>
                <div class="header-actions">
                  <span class="badge-small">{{ entry.intensity }}</span>
                  <button class="delete-btn" (click)="deleteEntry(entry.id, 'exercise')">ğŸ—‘ï¸</button>
                </div>
              </div>
              
              <div class="exercise-stats">
                <div class="stat-box">
                  <span class="stat-label">Trvanie</span>
                  <span class="stat-value">{{ entry.duration }} min</span>
                </div>
                @if (entry.caloriesBurned) {
                  <div class="stat-box">
                    <span class="stat-label">SpÃ¡lenÃ©</span>
                    <span class="stat-value">{{ entry.caloriesBurned }} kcal</span>
                  </div>
                }
              </div>
              
              <div class="detail-info">
                <span class="timestamp">{{ formatDate(entry.timestamp) }}</span>
              </div>
            </div>
          }
          
          <!-- Weight entries -->
          @if (selectedDetailType === 'weight') {
            <div class="detail-item" *ngFor="let entry of getSelectedEntries()">
              <div class="detail-header">
                <strong>{{ entry.weight }} kg</strong>
                <button class="delete-btn" (click)="deleteEntry(entry.id, 'weight')">ğŸ—‘ï¸</button>
              </div>
              <div class="detail-info">
                <span class="timestamp">{{ formatDate(entry.timestamp) }}</span>
              </div>
            </div>
          }
          
          <!-- Mood entries -->
          @if (selectedDetailType === 'mood') {
            <div class="detail-item" *ngFor="let entry of getSelectedEntries()">
              <div class="detail-header">
                <strong>SkÃ³re: {{ entry.score }}/10</strong>
                <button class="delete-btn" (click)="deleteEntry(entry.id, 'mood')">ğŸ—‘ï¸</button>
              </div>
              @if (entry.note) {
                <p class="note">{{ entry.note }}</p>
              }
              <div class="detail-info">
                <span class="timestamp">{{ formatDate(entry.timestamp) }}</span>
              </div>
            </div>
          }
          
          <!-- Stress entries -->
          @if (selectedDetailType === 'stress') {
            <div class="detail-item" *ngFor="let entry of getSelectedEntries()">
              <div class="detail-header">
                <strong>ÃšroveÅˆ: {{ entry.level }}/10</strong>
                <button class="delete-btn" (click)="deleteEntry(entry.id, 'stress')">ğŸ—‘ï¸</button>
              </div>
              @if (entry.source) {
                <p class="note">SpÃºÅ¡Å¥aÄe: {{ entry.source }}</p>
              }
              <div class="detail-info">
                <span class="timestamp">{{ formatDate(entry.timestamp) }}</span>
              </div>
            </div>
          }
          
          <!-- Sleep entries -->
          @if (selectedDetailType === 'sleep') {
            <div class="detail-item" *ngFor="let entry of getSelectedEntries()">
              <div class="detail-header">
                <strong>{{ entry.hours }} hodÃ­n</strong>
                <div class="header-actions">
                  <span class="badge-small">{{ entry.quality }}</span>
                  <button class="delete-btn" (click)="deleteEntry(entry.id, 'sleep')">ğŸ—‘ï¸</button>
                </div>
              </div>
              <div class="detail-info">
                <span class="timestamp">{{ formatDate(entry.timestamp) }}</span>
              </div>
            </div>
          }
        } @else {
          <div class="no-entries">
            <p>ğŸ“­ ZatiaÄ¾ Å¾iadne zÃ¡znamy</p>
            <span>ZaÄnite pridÃ¡vaÅ¥ zÃ¡znamy pre zobrazenie Å¡tatistÃ­k</span>
          </div>
        }
      </div>
    </aside>
  }
</div>
