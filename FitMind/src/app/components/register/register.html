<section class="auth">
  <div class="register-container">
    <div class="header-section">
      <h1>Vytvor si √∫ƒçet</h1>
      <p class="subtitle">Zaƒçni svoju fitness cestu s <span>FitMind</span></p>
    </div>

    <div class="progress-bar-container">
      <div class="progress-line">
        <div class="progress-fill" [style.width.%]="(currentStep / 3) * 100"></div>
      </div>
      <div class="progress-steps">
        <span class="step-dot" [class.active]="currentStep >= 1">1</span>
        <span class="step-dot" [class.active]="currentStep >= 2">2</span>
        <span class="step-dot" [class.active]="currentStep >= 3">3</span>
      </div>
    </div>

    <form (ngSubmit)="register()" class="register-form">
      @if (currentStep === 1) {
        <div class="form-section fade-in">
          <h3><mat-icon>person</mat-icon> Z√°kladn√© √∫daje</h3>
          
          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Meno</mat-label>
              <input matInput [(ngModel)]="profile.firstName" name="firstName" required />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Priezvisko</mat-label>
              <input matInput [(ngModel)]="profile.lastName" name="lastName" required />
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>E-mail</mat-label>
            <mat-icon matPrefix>email</mat-icon>
            <input matInput type="email" [(ngModel)]="email" name="email" required />
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Heslo</mat-label>
            <mat-icon matPrefix>lock</mat-icon>
            <input matInput type="password" [(ngModel)]="password" name="password" required />
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Vek</mat-label>
              <input matInput type="number" [(ngModel)]="profile.age" name="age" required />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Pohlavie</mat-label>
              <mat-select [(ngModel)]="profile.gender" name="gender" required>
                <mat-option value="male">Mu≈æ</mat-option>
                <mat-option value="female">≈Ωena</mat-option>
                <mat-option value="other">In√©</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      }

      @if (currentStep === 2) {
        <div class="form-section fade-in">
          <h3><mat-icon>straighten</mat-icon> Fyzick√© parametre</h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>V√Ω≈°ka (cm)</mat-label>
            <input matInput type="number" [(ngModel)]="profile.height" name="height" required />
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Aktu√°lna v√°ha (kg)</mat-label>
              <input matInput type="number" [(ngModel)]="profile.currentWeight" name="currentWeight" required />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Cieƒæov√° v√°ha (kg)</mat-label>
              <input matInput type="number" [(ngModel)]="profile.targetWeight" name="targetWeight" required />
            </mat-form-field>
          </div>

          <div class="bmi-card">
            <span class="bmi-label">Tvoje aktu√°lne BMI</span>
            <span class="bmi-value">{{ calculateBMI() }}</span>
          </div>
        </div>
      }

      @if (currentStep === 3) {
        <div class="form-section fade-in">
          <h3><mat-icon>track_changes</mat-icon> Tvoje ciele</h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Hlavn√Ω cieƒæ</mat-label>
            <mat-select [(ngModel)]="profile.fitnessGoal" name="fitnessGoal" required>
              <mat-option value="lose_weight">üî• Schudn√∫≈•</mat-option>
              <mat-option value="gain_muscle">üí™ Nabra≈• svalov√∫ hmotu</mat-option>
              <mat-option value="maintain">‚öñÔ∏è Udr≈æa≈• v√°hu</mat-option>
              <mat-option value="improve_health">‚ù§Ô∏è Zlep≈°i≈• zdravie</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>√örove≈à aktivity</mat-label>
            <mat-select [(ngModel)]="profile.activityLevel" name="activityLevel" required>
              <mat-option value="sedentary">ü™ë Sedav√Ω (m√°lo pohybu)</mat-option>
              <mat-option value="light">üö∂ ƒΩahko akt√≠vny (1-3 dni/t√Ω≈æde≈à)</mat-option>
              <mat-option value="moderate">üèÉ Stredne akt√≠vny (3-5 dn√≠/t√Ω≈æde≈à)</mat-option>
              <mat-option value="active">üèãÔ∏è Akt√≠vny (6-7 dn√≠/t√Ω≈æde≈à)</mat-option>
              <mat-option value="very_active">‚ö° Veƒæmi akt√≠vny (2x denne)</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Zdravotn√©/Di√©tne pozn√°mky</mat-label>
            <textarea matInput [(ngModel)]="medicalConditionsText" name="medicalConditions" rows="2"
              placeholder="Alergie, obmedzenia..."></textarea>
          </mat-form-field>
        </div>
      }

      @if (errorMsg) {
        <div class="error-box">
          <mat-icon>error_outline</mat-icon>
          <span>{{ errorMsg }}</span>
        </div>
      }

      <div class="button-group">
        @if (currentStep > 1) {
          <button mat-stroked-button type="button" class="btn-prev" (click)="previousStep()">
            Sp√§≈•
          </button>
        }

        @if (currentStep < 3) {
          <button mat-flat-button color="primary" type="button" class="btn-next" (click)="nextStep()">
            ƒéalej <mat-icon>arrow_forward</mat-icon>
          </button>
        }

        @if (currentStep === 3) {
          <button mat-flat-button class="btn-submit" type="submit" [disabled]="isLoading">
            @if (!isLoading) {
              <span>Dokonƒçi≈• registr√°ciu</span>
            } @else {
              <mat-spinner diameter="24"></mat-spinner>
            }
          </button>
        }
      </div>
    </form>

    <p class="link">
      U≈æ m√°≈° √∫ƒçet? <a routerLink="/login">Prihl√°s sa</a>
    </p>
  </div>
</section>