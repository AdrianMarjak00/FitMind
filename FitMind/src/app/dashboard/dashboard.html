<div class="dashboard-container">
    <h2>üìä My Dashboard</h2>

    <div *ngIf="!userId" class="warning">
        ‚ö†Ô∏è You must be logged in to view data
    </div>

    <div *ngIf="loading" class="loading">
        Loading data...
    </div>

    <div *ngIf="userId && !loading" class="main-grid">
        
        <div class="ai-activity-log">
            <h3>AI Activity Tracker</h3>
            
            <mat-card class="ai-input-card">
                <mat-form-field appearance="fill" class="full-width">
                    <textarea matInput 
                              rows="2" 
                              [(ngModel)]="aiInputText" 
                              name="aiInputText" 
                              (keydown.enter)="processAiInput()"
                              placeholder="e.g., I ate 3 eggs and 100g oats. Then I did a 45 min run."></textarea>
                </mat-form-field>
                
                <button mat-flat-button 
                        color="accent" 
                        [disabled]="!aiInputText || isProcessingAi" 
                        (click)="processAiInput()">
                    <mat-icon *ngIf="!isProcessingAi">send</mat-icon>
                    <mat-spinner *ngIf="isProcessingAi" diameter="20"></mat-spinner>
                    Process Input
                </button>
            </mat-card>

            <p *ngIf="errorMessage" class="error-msg">{{ errorMessage }}</p>
            
            <h3 class="recent-heading">Recent Entries</h3>
            <div class="recent-list">
                <div *ngFor="let entry of recentActivities" class="entry-item">
                    <mat-icon>{{ entry.type === 'Nutrition' ? 'restaurant' : 'directions_run' }}</mat-icon>
                    <div class="entry-details">
                        <span class="entry-title">{{ entry.description }}</span>
                        <span class="entry-time">{{ entry.timestamp | date:'shortTime' }}</span>
                    </div>
                    <div class="entry-calories">
                        <span *ngIf="entry.caloriesIn">+{{ entry.caloriesIn }} cal</span>
                        <span *ngIf="entry.caloriesOut">-{{ entry.caloriesOut }} cal</span>
                    </div>
                </div>
                <p *ngIf="!recentActivities || recentActivities.length === 0">No recent entries.</p>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div echarts [options]="caloriesChart" class="chart"></div>
            </div>
            <div class="chart-card">
                <div echarts [options]="exerciseChart" class="chart"></div>
            </div>
            <div class="chart-card">
                <div echarts [options]="moodChart" class="chart"></div>
            </div>
            <div class="chart-card">
                <div echarts [options]="stressChart" class="chart"></div>
            </div>
            <div class="chart-card">
                <div echarts [options]="sleepChart" class="chart"></div>
            </div>
            <div class="chart-card">
                <div echarts [options]="weightChart" class="chart"></div>
            </div>
        </div>
    </div>
</div>